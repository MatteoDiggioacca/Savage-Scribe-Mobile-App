/*DATABASE*/
CREATE DATABASE pjdm;
USE pjdm;

/*RAZZA*/
CREATE TABLE razza(nome_razza varchar(255) NOT NULL PRIMARY KEY, descr varchar(255) NOT NULL);

/*UTENTE*/
CREATE TABLE utente(username varchar(255) NOT NULL PRIMARY KEY, password varchar(255) NOT NULL);

/*CAMPAGNA*/
CREATE TABLE campagna(id_campagna int NOT NULL AUTO_INCREMENT PRIMARY KEY, nome_campagna varchar(255) NOT NULL, descr varchar(255), user_creatore varchar(255) NOT NULL, foreign key(user_creatore) references utente(username) ON DELETE CASCADE);

/*SCHEDA PERSONAGGIO*/
CREATE TABLE scheda(
id_scheda int NOT NULL AUTO_INCREMENT PRIMARY KEY,
nome varchar(255) NOT NULL,
proprietario varchar(255) NOT NULL, foreign key(proprietario) references utente(username) ON DELETE CASCADE,
nome_razza varchar(255) NOT NULL, foreign key(nome_razza) references razza(nome_razza) ON DELETE CASCADE,
sesso varchar(255) NOT NULL,
eta int NOT NULL,
visibilita int NOT NULL,
exp tinyint NOT NULL,
agi tinyint NOT NULL, forz tinyint NOT NULL, inte tinyint NOT NULL, spi tinyint NOT NULL, vig tinyint NOT NULL);

alter table scheda add constraint chk_stat CHECK(agi=0 or agi=2 or agi=4 or agi=6 or agi=8 or agi=10 or agi=12);
alter table scheda add constraint chk_stat2 CHECK(forz=0 or forz=2 or forz=4 or forz=6 or forz=8 or forz=10 or forz=12);
alter table scheda add constraint chk_stat3 CHECK(inte=0 or inte=2 or inte=4 or inte=6 or inte=8 or inte=10 or inte=12);
alter table scheda add constraint chk_stat4 CHECK(spi=0 or spi=2 or spi=4 or spi=6 or spi=8 or spi=10 or spi=12);
alter table scheda add constraint chk_stat5 CHECK(vig=0 or vig=2 or vig=4 or vig=6 or vig=8 or vig=10 or vig=12);
alter table scheda add constraint chk_vis CHECK(visibilita=0 or visibilita=1);

/*OGGETTO*/
CREATE TABLE oggetto(id_oggetto int NOT NULL AUTO_INCREMENT PRIMARY KEY, id_scheda int NOT NULL, foreign key(id_scheda) references scheda(id_scheda) ON DELETE CASCADE, nome_oggetto varchar(255) NOT NULL, peso varchar(255) NOT NULL, note varchar(255));

/*PARTECIPA*/
CREATE TABLE partecipa(user varchar(255) NOT NULL, id_campagna int NOT NULL, id_scheda int NOT NULL, primary key(user,id_campagna), foreign key(user) references utente(username) on delete cascade, foreign key(id_campagna) references campagna(id_campagna) on delete cascade, foreign key(id_scheda) references scheda(id_scheda) on delete cascade);

/*NOTIFICA*/
CREATE TABLE notifica(id_notifica int NOT NULL AUTO_INCREMENT PRIMARY KEY, mittente varchar(255) NOT NULL, foreign key(mittente) references utente(username) ON DELETE CASCADE, destinatario varchar(255) NOT NULL, foreign key(destinatario) references utente(username) ON DELETE CASCADE, id_campagna int NOT NULL, foreign key(id_campagna) references campagna(id_campagna) ON DELETE CASCADE);